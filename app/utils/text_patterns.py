import re
from typing import Dict, List

# 정규식 패턴은 최소화하고 결정론적으로 유지.
RISK_SIGNAL_RULES: Dict[str, List[re.Pattern]] = {
    "money_request": [
        re.compile(
            r"(송금|입금|결제|이체)\s*(해|해주세요|해요|해\s*주세요|부탁|부탁드립니다|요청|주시|주시면|주셔야|해야|하셔야)"
        ),
        re.compile(
            r"(돈|현금|카드|상품권|보증금|예약금)\s*(으로|로)?\s*(보내|송금|입금|결제)\s*(해|해주세요|해요|해\s*주세요|주시|주시면|주셔야|해야|하셔야)"
        ),
        re.compile(
            r"(계좌번호|계좌)(?:\s*로)?\s*(먼저|우선)?\s*(알려|알려줘|알려주세요|알려주시면|보내|보내줘|보내주세요|보내주시면|공유|주세요|주시면|주셔야|주실|받아야|받아야\s*합니다|받아야\s*해요)"
        ),
        re.compile(
            r"(소액|선입금)\s*(이라도)?\s*(먼저)?\s*(보내|입금|송금)\s*(주셔야|주세요|해|해야|하셔야|해요|해\s*주세요)"
        ),
    ],
    "urgency": [
        re.compile(r"(긴급|급히|급해요|급합니다|급함|서둘러|지체\s*없이)"),
        re.compile(r"(지금\s*당장|지금\s*바로|바로\s*지금|오늘\s*내로|몇\s*시간\s*안에)"),
        re.compile(r"오늘\s*안에(?!.*(안\s*하셔도|안\s*해도|괜찮|무관))"),
        re.compile(r"지금\s*(처리|결정|응답)\s*(해|해주세요|하셔야|해야|해\s*주세요)"),
        re.compile(r"지금\s*(결정|처리|응답)하셔야"),
        re.compile(r"지금\s*.*(안\s*하면|안\s*하시면).*(불이익|기회|취소|다음\s*순번)"),
    ],
    "credential_request": [
        re.compile(
            r"(비밀번호|인증\s*코드|인증코드|인증번호|otp|일회용|pin)\s*(알려|알려줘|알려주세요|보내|보내줘|보내주세요|입력|입력해|입력해주세요|공유|말해)"
        ),
    ],
}

SIGNAL_QUERY_TERMS: Dict[str, List[str]] = {
    "money_request": ["입금", "송금", "계좌", "보증금", "예약금", "결제"],
    "urgency": ["오늘 안에", "지금", "당장", "즉시", "몇 시간 안에"],
    "credential_request": ["인증코드", "otp", "비밀번호", "pin"],
}

CONVERSATION_TYPE_RULES: Dict[str, List[re.Pattern]] = {
    "중고거래": [
        re.compile(r"(중고|직거래|택배|판매|구매|가격|송장)"),
    ],
    "투자": [
        re.compile(r"(투자|수익|수익률|코인|암호화폐|주식|FX|선물|레버리지)"),
    ],
    "대출": [
        re.compile(r"(대출|이자|상환|대부|차용)"),
    ],
    "취업": [
        re.compile(r"(취업|채용|구인|면접|이력서|지원서|재택|알바|아르바이트|급여|수당|계약서)"),
    ],
}
